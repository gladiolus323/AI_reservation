# 합성데이터 생성 보고서

## 1. 개요

### 1.1 목적

본 합성데이터는 다음 목적으로 생성되었습니다:
- 검사규칙 스키마의 실용성 검증
- 룰엔진 개발 및 테스트
- 예약 시간표 뷰어 개발

### 1.2 생성 규모

| 항목 | 수치 |
|------|------|
| 예약 건수 | 12,063건 |
| 환자 수 | 2,602명 |
| 검사 코드 사용 | 264개 (100%) |
| 기간 | 2026-01-01 ~ 2026-12-31 (1년) |
| 자원 (장비) | 36대 |

---

## 2. 생성 전략

### 2.1 검사 코드 커버리지

모든 검사 코드(264개)가 최소 1회 이상 사용되도록 보장했습니다.

**가중치 적용**:
- 빈도가 높은 검사 (CT, MRI 등): 높은 가중치
- 빈도가 낮은 검사: 최소 1회 보장

### 2.2 환자 생성

| 항목 | 수치 |
|------|------|
| 환자당 평균 예약 | 4.64건 |
| 다중 검사 환자 비율 | 85.5% (2,226명) |
| 최대 예약 건수 | 23건/환자 |

**다중 검사 환자 비율이 높은 이유**:
- 실제 병원에서 여러 검사를 함께 처방하는 패턴 반영
- 검사 간 규칙 (순서, 간격) 테스트를 위해 의도적으로 설계

### 2.3 시간대 분포

오전 집중, 오후 감소 패턴을 적용했습니다.

| 시간대 | 예약 건수 | 비율 |
|--------|-----------|------|
| 08시 | 859건 | 7.1% |
| 09시 | 1,999건 | 16.6% |
| 10시 | 1,970건 | 16.3% |
| 11시 | 2,001건 | 16.6% |
| 12시 | 1,805건 | 15.0% |
| 13시 | 1,792건 | 14.9% |
| 14시 | 1,415건 | 11.7% |
| 15시 이후 | 222건 | 1.8% |

### 2.4 요일별 분포

주말 제한 규칙(NOWEEKEND)을 반영했습니다.

| 요일 | 예약 건수 | 비율 |
|------|-----------|------|
| 월요일 | 2,212건 | 18.3% |
| 화요일 | 2,228건 | 18.5% |
| 수요일 | 2,325건 | 19.3% |
| 목요일 | 2,295건 | 19.0% |
| 금요일 | 2,294건 | 19.0% |
| 토요일 | 709건 | 5.9% |
| 일요일 | 0건 | 0% |

**특이사항**:
- 일요일 예약 0건 (운영 규칙 준수)
- 토요일은 주말 가능 검사만 예약
- 평일 균등 분포 (18~19%)

### 2.5 월별 분포

연간 균등 분포를 목표로 생성했습니다.

| 월 | 예약 건수 |
|----|-----------|
| 1월 | 1,038건 |
| 2월 | 944건 |
| 3월 | 990건 |
| 4월 | 1,062건 |
| 5월 | 956건 |
| 6월 | 1,014건 |
| 7월 | 1,015건 |
| 8월 | 981건 |
| 9월 | 1,005건 |
| 10월 | 1,010건 |
| 11월 | 981건 |
| 12월 | 1,067건 |

---

## 3. 장비별 현황

### 3.1 예약 분포

| 장비 | 예약 건수 | 비율 | 자원 수 |
|------|-----------|------|---------|
| FUNC | 6,247건 | 51.8% | 8대 |
| CT | 1,328건 | 11.0% | 4대 |
| MRI | 1,182건 | 9.8% | 5대 |
| ENDO | 892건 | 7.4% | 5대 |
| US | 862건 | 7.1% | 4대 |
| NM | 604건 | 5.0% | 4대 |
| XRAY | 518건 | 4.3% | 3대 |
| FLUORO | 430건 | 3.6% | 3대 |
| **합계** | **12,063건** | **100%** | **36대** |

### 3.2 자원 수량 결정 과정

초기 생성 시 자원 충돌이 발생하여 다음과 같이 조정했습니다:

| 장비 | 초기 | 최종 | 조정 사유 |
|------|------|------|-----------|
| US | 3대 | 4대 | 동일 시간대 충돌 |
| XRAY | 2대 | 3대 | 동일 시간대 충돌 |
| 기타 | - | - | 변경 없음 |

---

## 4. 규칙 적용 결과

### 4.1 RELATION_RULES 적용

87개 검사 간 관계 규칙을 적용했습니다.

| 규칙 유형 | 적용 건수 | 위반 건수 |
|-----------|-----------|-----------|
| SEQ_REQ_YN=Y (순서 필수) | 해당 쌍 전체 | 0건 |
| SAME_DAY_CD=N (당일 불가) | 해당 쌍 전체 | 0건 |
| GAP_VALUE (최소 간격) | 해당 쌍 전체 | 0건 |

### 4.2 CONDITION_RULES 적용

48개 조건 규칙을 적용했습니다.

| 규칙 유형 | 설명 | 위반 건수 |
|-----------|------|-----------|
| NOWEEKEND | 주말 예약 금지 | 0건 |
| TIMEONLY | 특정 시간대만 가능 | 0건 |
| FASTING | 금식 필요 | (메타데이터) |
| GUARD | 보호자 동반 | (메타데이터) |

### 4.3 자원 충돌 검사

| 검사 항목 | 결과 |
|-----------|------|
| 동일 자원 동일 시간 중복 | 0건 |
| 예약 시간 겹침 | 0건 |

---

## 5. 데이터 품질 검증

### 5.1 규칙 위반 검증

verify_reservation.py 스크립트로 검증한 결과:

| 검증 항목 | 위반 건수 |
|-----------|-----------|
| 일요일 예약 | 0건 |
| NOWEEKEND 규칙 | 0건 |
| SAME_DAY_CD=N 규칙 | 0건 |
| GAP_VALUE 규칙 | 0건 |
| SEQ_REQ_YN=Y 규칙 | 0건 |
| 자원 충돌 | 0건 |

**전체 규칙 위반: 0건**

### 5.2 데이터 무결성 검증

| 검증 항목 | 결과 |
|-----------|------|
| EXAM_CD 참조 무결성 | 100% 통과 |
| RESOURCE_ID 참조 무결성 | 100% 통과 |
| 날짜/시간 형식 | 100% 유효 |
| 필수 필드 NULL | 0건 |

---

## 6. 룰엔진 테스트

### 6.1 테스트 시나리오

신규 환자(P999999)에게 4개 검사 처방 후 스케줄링:

| 검사 코드 | 검사명 | 장비 |
|-----------|--------|------|
| RC060003 | Abdomen CT (CE) | CT |
| RM010029 | (3T)MRI-Liver (CE) + DWI | MRI |
| RU010003 | Abdomen 정밀 초음파 | US |
| SC030010 | colon-Fiberscopy | ENDO |

### 6.2 적용된 규칙

| 규칙 | 내용 |
|------|------|
| SC030010 → RC060003 | 대장내시경 먼저 (진정 관련) |
| 60분 간격 | 내시경-CT 간 최소 간격 |
| 당일 시행 가능 | SAME_DAY_CD=C |

### 6.3 스케줄링 결과

| 날짜 | 시간 | 검사 | 자원 |
|------|------|------|------|
| 2026-02-02 | 08:00~08:30 | SC030010 (대장내시경) | ENDO_01 |
| 2026-02-02 | 09:00~09:20 | RC060003 (복부CT조영) | CT_01 |
| 2026-02-03 | 08:00~08:45 | RM010029 (간MRI) | MRI_01 |
| 2026-02-03 | 09:00~09:20 | RU010003 (복부초음파) | US_01 |

### 6.4 충돌 검증

기존 12,063건 예약과 충돌 여부 확인:

| 검사 | 충돌 여부 |
|------|-----------|
| SC030010 | 충돌 없음 ✓ |
| RC060003 | 충돌 없음 ✓ |
| RM010029 | 충돌 없음 ✓ |
| RU010003 | 충돌 없음 ✓ |

---

## 7. 생성 스크립트

### 7.1 사용된 스크립트

| 스크립트 | 기능 |
|----------|------|
| generate_reservation.py | 예약 데이터 생성 |
| assign_resource.py | 자원 배정 |
| verify_reservation.py | 규칙 위반 검증 |

### 7.2 실행 순서

```bash
# 1. 예약 데이터 생성
python src/generate_reservation.py

# 2. 자원 배정
python src/assign_resource.py

# 3. 규칙 검증
python src/verify_reservation.py
```

---

## 8. 생성된 파일

| 파일 | 경로 | 설명 |
|------|------|------|
| RESERVATION.csv | data/ | 예약 데이터 (12,063건) |
| RESOURCE.csv | data/ | 자원 마스터 (36대) |

### 8.1 RESERVATION.csv 컬럼

| 컬럼 | 타입 | 설명 |
|------|------|------|
| RESERVATION_ID | VARCHAR(10) | 예약 ID |
| ORDER_ID | VARCHAR(10) | 처방 ID |
| PATIENT_ID | VARCHAR(7) | 환자 ID |
| ORDER_DATE | DATE | 처방일 |
| EXAM_CD | VARCHAR(10) | 검사 코드 |
| EXAM_NM | VARCHAR(100) | 검사명 |
| RESERVATION_DATETIME | DATETIME | 예약 일시 |
| RESERVATION_DATE | DATE | 예약 날짜 |
| RESERVATION_TIME | TIME | 예약 시간 |
| DURATION_MIN | INT | 소요 시간 (분) |
| EQUIPMENT_TYPE | VARCHAR(10) | 장비 유형 |
| RESOURCE_ID | VARCHAR(10) | 자원 ID |

### 8.2 RESOURCE.csv 컬럼

| 컬럼 | 타입 | 설명 |
|------|------|------|
| RESOURCE_ID | VARCHAR(10) | 자원 ID |
| EQUIPMENT_TYPE | VARCHAR(10) | 장비 유형 |
| RESOURCE_NAME | VARCHAR(50) | 자원명 |

---

## 9. 결론

### 9.1 성과

| 항목 | 결과 |
|------|------|
| 검사 코드 커버리지 | 100% (264/264) |
| 규칙 위반 | 0건 |
| 자원 충돌 | 0건 |
| 룰엔진 테스트 | 성공 |

### 9.2 활용 방안

1. **스키마 검증**: 모든 규칙이 정상 적용됨을 확인
2. **룰엔진 개발**: 신규 환자 예약 스케줄링 테스트 완료
3. **시간표 뷰어**: 웹 기반 예약 현황 시각화 완료

### 9.3 한계점

1. 환자 연령, 질환 등 조건 규칙은 메타데이터로만 반영
2. 실제 병원 예약 패턴과 다를 수 있음
3. 특정 장비(FUNC)에 예약 집중

---

*작성일: 2024-12-24*
*버전: 1.0*
