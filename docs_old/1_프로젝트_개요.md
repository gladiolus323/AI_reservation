# 검사규칙 합성데이터 프로젝트

**최종 수정일**: 2025-12-24

---

## 1. 프로젝트 목적

병원 검사 예약 업무 매뉴얼(38페이지 PDF)을 분석하여:
1. 검사 예약 규칙을 **정형화된 데이터베이스 스키마**로 설계
2. 해당 스키마에 맞는 **합성 데이터** 생성
3. 규칙 기반 예약 스케줄링 시스템 개발 지원

### 왜 필요한가?

| 기존 방식 | 개선 방식 |
|----------|----------|
| PDF 매뉴얼을 사람이 읽고 판단 | 규칙을 데이터로 저장하여 시스템이 자동 판단 |
| 규칙 변경 시 매뉴얼 수정 + 재교육 | 데이터만 수정하면 즉시 반영 |
| 병원별로 다른 매뉴얼 형식 | 범용 스키마로 표준화 가능 |

### 프로젝트 범위

- **포함**: 검사(Examination) 예약 규칙
- **제외**: 시술(Procedure) 관련 규칙 (예: Biopsy)

---

## 2. 작업 흐름

```
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 1: 매뉴얼 분석                                                │
│     ├─ PDF 38페이지 전체 분석                                        │
│     ├─ 규칙 추출 및 분류 (131개)                                     │
│     └─ 정형화 가능 여부 판단                                         │
└──────────────────────────┬──────────────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 2: 스키마 설계                                                │
│     ├─ 3개 테이블 정의 (EXAM_MASTER, RELATION, CONDITION)            │
│     ├─ 코드값 정의 (code_definition.csv)                             │
│     └─ 범용성 검토 (다른 병원에서도 사용 가능하도록)                   │
└──────────────────────────┬──────────────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 3: 합성 데이터 생성                                           │
│     ├─ 매뉴얼 규칙을 실제 검사코드로 매핑                             │
│     ├─ 12,063건 예약 데이터 생성                                     │
│     └─ 36대 자원(장비) 배정                                          │
└──────────────────────────┬──────────────────────────────────────────┘
                           ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 4: 검증 및 시각화                                             │
│     ├─ 규칙 위반 검증 (0건 확인)                                     │
│     ├─ 자원 충돌 검증 (0건 확인)                                     │
│     └─ 웹 기반 시간표 뷰어 개발                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. 디렉토리 구조

```
검사규칙 합성데이터/
├── data/                          # 생성된 CSV 데이터
│   ├── EXAM_MASTER.csv            # 검사 마스터 (265개)
│   ├── EXAM_RELATION_RULES.csv    # 검사 간 관계 규칙 (88건)
│   ├── EXAM_CONDITION_RULES.csv   # 검사 조건 규칙 (47건)
│   ├── RESERVATION.csv            # 예약 데이터 (12,063건)
│   └── RESOURCE.csv               # 자원 마스터 (36대)
│
├── schema/                        # 스키마 정의
│   ├── EXAM_MASTER.csv            # 검사 기본 정보 스키마
│   ├── EXAM_RELATION_RULES.csv    # 검사 간 관계 스키마
│   └── EXAM_CONDITION_RULES.csv   # 조건부 규칙 스키마
│
├── src/                           # 소스 코드
│   ├── generate_reservation.py    # 예약 데이터 생성
│   ├── verify_reservation.py      # 규칙 위반 검증
│   ├── assign_resource.py         # 자원 배정
│   └── generate_schedule_html.py  # 시간표 HTML 생성
│
├── web/                           # 웹 뷰어
│   └── schedule_viewer.html       # 예약 시간표 뷰어
│
├── docs/                          # 문서
│   ├── 1_프로젝트_개요.md         # 본 문서
│   ├── 2_스키마_설계.md           # 스키마 상세 설계
│   └── 3_합성데이터_생성.md       # 합성데이터 생성 상세
│
├── code_definition.csv            # 코드값 정의
└── 통합 검사예약업무 매뉴얼.pdf   # 원본 매뉴얼 (38p)
```

---

## 4. 성과 요약

### 4.1 스키마 설계

| 테이블 | 건수 | 설명 |
|--------|------|------|
| EXAM_MASTER | 265건 | 검사 기본 정보 |
| EXAM_RELATION_RULES | 88건 | 검사 간 관계 규칙 |
| EXAM_CONDITION_RULES | 47건 | 조건부 규칙 |

### 4.2 합성 데이터

| 항목 | 수치 |
|------|------|
| 예약 건수 | 12,063건 |
| 환자 수 | 2,602명 |
| 검사 코드 커버리지 | 264개 (100%) |
| 기간 | 2026-01-01 ~ 2026-12-31 |
| 자원 (장비) | 36대 |

### 4.3 규칙 준수 현황

| 규칙 | 위반 건수 |
|------|----------|
| 일요일 예약 금지 | 0건 |
| NOWEEKEND (토요일 제한) | 0건 |
| SAME_DAY_CD=N (당일 불가) | 0건 |
| GAP_VALUE (검사 간 간격) | 0건 |
| SEQ_REQ_YN=Y (순서 필수) | 0건 |
| 자원 충돌 | 0건 |

---

## 5. 실행 방법

### 예약 데이터 재생성
```bash
python src/generate_reservation.py
python src/assign_resource.py
```

### 규칙 검증
```bash
python src/verify_reservation.py
```

### HTML 뷰어 생성
```bash
python src/generate_schedule_html.py
# 결과: web/schedule_viewer.html
```

---

## 6. 매뉴얼 분석 결과

### 6.1 규칙 분류

| 분류 | 건수 | 설명 |
|------|------|------|
| 정형화 가능 | 99개 | 스키마로 표현 가능한 규칙 |
| 로직 구현 필요 | 15개 | 동적 계산, 캘린더 조회 등 |
| 정형화 불필요 | 17개 | 임시 공지, 운영 지침 등 |
| **합계** | **131개** | |

### 6.2 정형화 가능 규칙 예시

| 매뉴얼 원문 | 정형화 방식 |
|------------|------------|
| "만 19세 미만 조영제 검사 시 보호자 동반 필수" | COND_TYPE=AGE, COND_OP=<, COND_VAL=19, ACTION_CD=GUARD |
| "CT(조영제) 후 BMD 3일 간격" | EXAM_A=CT, EXAM_B=BMD, GAP_VALUE=3, GAP_UNIT=D |
| "MRI 조영제→조영제 24시간 간격" | EXAM_A=MRI, EXAM_B=MRI, GAP_VALUE=24, GAP_UNIT=H |

---

## 7. 설계 특징

### 7.1 범용성
- 병원 특화 개념 제거 (교수 조건 등)
- 의미있는 문자 코드 사용 (Y/N/C, GUARD/STOPMED 등)
- 유연한 연령 표현 (MIN_AGE/MAX_AGE 숫자형)

### 7.2 확장성
- 역방향 간격 지원 (REV_GAP_VALUE/UNIT)
- 시간 제한 이원화 (EXAM_MASTER vs CONDITION_RULES)
- 새 규칙 유형 추가 용이

### 7.3 명확성
- GAP_VALUE NULL 해석 규칙 명시 (기본 1일)
- 모든 코드값 정의서 제공 (code_definition.csv)

---

## 8. 한계 및 향후 과제

### 8.1 현재 한계
- 시술(Biopsy 등) 규칙 미포함
- 로직 구현 필요 규칙 15개 (동적 계산, 공휴일 조회 등)
- 환자 연령/질환 조건은 메타데이터로만 반영

### 8.2 향후 과제
1. 미정형화 규칙 15개 비즈니스 로직 모듈 개발
2. 월간 뷰, 검색 기능 추가
3. 다기관 적용을 위한 설정 파라미터화

---

## 9. 관련 문서

| 문서 | 내용 |
|------|------|
| [2_스키마_설계.md](2_스키마_설계.md) | 테이블 구조, 코드 체계, 정형화 분석 상세 |
| [3_합성데이터_생성.md](3_합성데이터_생성.md) | 데이터 생성 로직, EDA, 검증 결과 상세 |

---

*최종 업데이트: 2025-12-24*
