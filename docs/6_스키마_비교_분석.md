# 스키마 비교 분석

**작성일**: 2025-12-29

---

## 1. 개요

| 항목 | 기존 스키마 (안동개발기) | 현재 스키마 |
|------|------------------------|------------|
| 출처 | 테이블 구조_검사세트 테이블사용.xlsx | 본 프로젝트 설계 |
| 테이블 수 | 2개 | 3개 |
| 목적 | 검사세트 처방 관리 | 예약 규칙 정형화 |

---

## 2. 테이블 구조 비교

### 2.1 테이블 구성

| 구분 | 기존 스키마 | 현재 스키마 |
|------|------------|------------|
| 마스터 | MSCEXMSM (검사세트처방기본) | EXAM_MASTER |
| 관계 | MSCEXMSD (검사세트처방상세) | EXAM_RELATION_RULES |
| 조건 | 없음 | EXAM_CONDITION_RULES |

### 2.2 기존 스키마: MSCEXMSM (검사세트처방기본)

| 컬럼명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| HSP_TP_CD | VARCHAR2(2) | PK | 병원구분코드 |
| SORD_REG_ID | VARCHAR2(50) | PK | 세트처방등록ID |
| UPR_SORD_REG_ID | VARCHAR2(50) | | 상위세트처방등록ID |
| DEPT_CD | VARCHAR2(50) | | 부서코드 |
| DOC_STF_SID | VARCHAR2(07) | | 의사직원식별ID |
| SORD_TP_CD | VARCHAR2(02) | Y | 세트처방구분코드 (1,2,3,4) |
| SORD_NM | VARCHAR2(500) | Y | 세트처방명 |
| DRCT_ITVL_DYS | NUMBER | | 직접간격일수 |
| DRCT_ITVL_UNT_CD | VARCHAR2(1) | | 직접간격단위코드 |
| NONE_DRCT_ITVL_DYS | NUMBER | | 역방향간격일수 |
| NONE_DRCT_ITVL_UNT_CD | VARCHAR2(1) | | 역방향간격단위코드 |
| EQLT_EXRM_YN | VARCHAR2(1) | | 동일검사실여부 |
| STR_DTE | DATE | Y | 시작일자 |
| END_DTE | DATE | | 종료일자 |
| USE_YN | VARCHAR2(01) | Y | 사용여부 |

### 2.3 기존 스키마: MSCEXMSD (검사세트처방상세)

| 컬럼명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| HSP_TP_CD | VARCHAR2(02) | PK | 병원구분코드 |
| SORD_REG_ID | VARCHAR2(50) | PK | 세트처방등록ID |
| SORD_DTL_TP_CD | VARCHAR2(01) | Y | 세트처방상세구분코드 (A/B) |
| SORD_DTL_SEQ | NUMBER | Y | 세트처방상세순번 |
| ORD_CD | VARCHAR2(20) | Y | 처방코드 |
| ORD_NM | VARCHAR2(500) | Y | 처방명 |
| ORD_CTG_CD | VARCHAR2(03) | | 처방구분코드 |

### 2.4 기존 SORD_TP_CD 코드값

| 코드 | 의미 |
|------|------|
| 1 | 같은날검사불가 |
| 2 | 같은날연속검사 |
| 3 | 순서/간격 필요 검사 |
| 4 | 간격 필요 검사 (ALL) |

---

## 3. 컬럼 매핑 비교

| 기존 컬럼 | 기존 설명 | 현재 컬럼 | 현재 테이블 | 변환 방식 |
|----------|----------|----------|------------|----------|
| SORD_TP_CD=1 | 같은날불가 | SAME_DAY_CD=N | RELATION | 코드값 분리 |
| SORD_TP_CD=2 | 같은날연속 | SAME_DAY_CD=Y, SEQ_REQ_YN=Y | RELATION | 코드값 분리 |
| SORD_TP_CD=3 | 순서/간격 | SEQ_REQ_YN=Y, GAP_VALUE | RELATION | 코드값 분리 |
| SORD_TP_CD=4 | 간격만 | GAP_VALUE, GAP_UNIT | RELATION | 코드값 분리 |
| DRCT_ITVL_DYS | 직접간격일수 | GAP_VALUE | RELATION | 동일 |
| DRCT_ITVL_UNT_CD | 직접간격단위 | GAP_UNIT | RELATION | 동일 |
| NONE_DRCT_ITVL_DYS | 역방향간격일수 | REV_GAP_VALUE | RELATION | 동일 |
| NONE_DRCT_ITVL_UNT_CD | 역방향간격단위 | REV_GAP_UNIT | RELATION | 동일 |
| ORD_CD (A) | 선행 처방코드 | EXAM_A | RELATION | 분리 |
| ORD_CD (B) | 후행 처방코드 | EXAM_B | RELATION | 분리 |
| - | - | REASON_CD | RELATION | 신규 추가 |
| - | - | COND_TYPE | CONDITION | 신규 테이블 |
| - | - | COND_OP | CONDITION | 신규 테이블 |
| - | - | ACTION_CD | CONDITION | 신규 테이블 |
| - | - | DURATION_MIN | MASTER | 신규 추가 |
| - | - | FASTING_HRS | MASTER | 신규 추가 |
| - | - | CONTRAST_YN | MASTER | 신규 추가 |

---

## 4. 규칙 표현력 비교

### 4.1 관계 규칙 (RELATION)

| 규칙 유형 | 기존 스키마 | 현재 스키마 | 표현 가능 |
|----------|------------|------------|----------|
| 당일 불가 | SORD_TP_CD=1 | SAME_DAY_CD=N | O / O |
| 당일 연속 (순서 필수) | SORD_TP_CD=2 | SAME_DAY_CD=Y, SEQ_REQ_YN=Y | O / O |
| 순서+간격 필요 | SORD_TP_CD=3 | SEQ_REQ_YN=Y, GAP_VALUE/UNIT | O / O |
| 간격만 필요 | SORD_TP_CD=4 | GAP_VALUE, GAP_UNIT | O / O |
| 역방향 간격 | NONE_DRCT_ITVL_* | REV_GAP_VALUE/UNIT | O / O |
| 제한 사유 코드 | 표현 불가 | REASON_CD | X / O |
| 조건부 당일 가능 | 표현 불가 | SAME_DAY_CD=C | X / O |

### 4.2 조건 규칙 (CONDITION)

| 규칙 유형 | 기존 스키마 | 현재 스키마 | 표현 가능 |
|----------|------------|------------|----------|
| 연령 조건 (소아/고령) | 표현 불가 | AGE + GUARD/TIMEONLY | X / O |
| 약물 복용 조건 | 표현 불가 | MED + STOPMED | X / O |
| 요일 제한 | 표현 불가 | WEEKDAY + NOWEEKEND | X / O |
| 질환 조건 | 표현 불가 | DISEASE + PRETEST | X / O |
| 의료기기 조건 | 표현 불가 | DEVICE + TIMEONLY | X / O |
| 알레르기 조건 | 표현 불가 | ALLERGY + CONSENT | X / O |
| 임신/수유 조건 | 표현 불가 | PREG + CONSENT | X / O |
| 검사 간격 위반 | 표현 불가 | INTERVAL + 비급여 | X / O |
| 식이 조건 | 표현 불가 | DIET + STOPMED | X / O |
| 검사 수치 조건 | 표현 불가 | LAB + PRETEST | X / O |

### 4.3 속성 규칙 (ATTRIBUTE)

| 규칙 유형 | 기존 스키마 | 현재 스키마 | 표현 가능 |
|----------|------------|------------|----------|
| 검사 소요시간 | 표현 불가 | DURATION_MIN | X / O |
| 금식 시간 | 표현 불가 | FASTING_HRS | X / O |
| 조영제 사용 | 표현 불가 | CONTRAST_YN | X / O |
| 진정 검사 | 표현 불가 | SEDATION_YN | X / O |
| 연령 제한 | 표현 불가 | MIN_AGE, MAX_AGE | X / O |
| 운영 시간 | 표현 불가 | AVAIL_START/END_TIME | X / O |

---

## 5. 규칙 커버리지 비교

| 규칙 분류 | 매뉴얼 규칙 | 기존 스키마 | 현재 스키마 |
|----------|-----------|------------|------------|
| RELATION (관계) | 64개 | ~40개 (일부) | 64개 (100%) |
| CONDITION (조건) | 54개 | 0개 | 54개 (100%) |
| ATTRIBUTE (속성) | 21개 | 0개 | 21개 (100%) |
| LOGIC (로직) | 14개 | 0개 | 0개 |
| UNNECESSARY (불필요) | 17개 | 0개 | 0개 |
| **합계** | **170개** | **~40개 (24%)** | **139개 (82%)** |

---

## 6. 설계 차이점 분석

### 6.1 구조적 차이

| 항목 | 기존 스키마 | 현재 스키마 |
|------|------------|------------|
| 검사 정의 | 별도 테이블 없음 (ORD_CD만) | EXAM_MASTER (14개 속성) |
| 관계 정의 | 마스터+상세 2단계 | 단일 테이블 (EXAM_A, EXAM_B) |
| 조건 정의 | 없음 | EXAM_CONDITION_RULES |
| 규칙 구분 | SORD_TP_CD 단일 코드 | SAME_DAY_CD, SEQ_REQ_YN 분리 |
| 제한 사유 | 없음 | REASON_CD 6종 |

### 6.2 기존 스키마의 한계

| 한계 | 설명 | 현재 스키마 해결 |
|------|------|-----------------|
| 조건부 규칙 불가 | 환자 상태별 규칙 표현 불가 | EXAM_CONDITION_RULES |
| 제한 사유 없음 | 왜 불가인지 표현 불가 | REASON_CD |
| 검사 속성 없음 | 소요시간, 금식 등 표현 불가 | EXAM_MASTER |
| 단일 코드 한계 | SORD_TP_CD로 4가지만 구분 | 다중 컬럼으로 조합 가능 |
| 조건부 당일 불가 | 조건에 따른 당일 가능 표현 불가 | SAME_DAY_CD=C |

### 6.3 기존 스키마의 장점

| 장점 | 설명 |
|------|------|
| 병원 시스템 호환 | 기존 HIS 테이블 구조와 호환 |
| 부서/의사 연동 | DEPT_CD, DOC_STF_SID로 의사별 설정 가능 |
| 기간 관리 | STR_DTE, END_DTE로 유효기간 관리 |
| 사용여부 관리 | USE_YN으로 활성화/비활성화 |

---

## 7. 결론

### 7.1 커버리지 비교

| 항목 | 기존 스키마 | 현재 스키마 |
|------|------------|------------|
| 전체 규칙 (170개) | ~40개 (24%) | 139개 (82%) |
| 관계 규칙 (64개) | ~40개 (63%) | 64개 (100%) |
| 조건 규칙 (54개) | 0개 (0%) | 54개 (100%) |
| 속성 규칙 (21개) | 0개 (0%) | 21개 (100%) |

### 7.2 개선 효과

| 항목 | 기존 → 현재 | 개선율 |
|------|------------|--------|
| 규칙 커버리지 | 24% → 82% | +58%p |
| 조건 규칙 지원 | 0% → 100% | +100%p |
| 속성 규칙 지원 | 0% → 100% | +100%p |
| 제한 사유 표현 | 불가 → 6종 | 신규 |
| 조건부 당일 | 불가 → 가능 | 신규 |

### 7.3 요약

| 스키마 | 강점 | 약점 | 적합 용도 |
|--------|------|------|----------|
| 기존 | HIS 호환, 의사별 설정 | 조건규칙 불가, 낮은 커버리지 | 단순 검사세트 관리 |
| 현재 | 높은 커버리지, 조건규칙 지원 | HIS 별도 연동 필요 | 규칙 기반 예약 시스템 |
