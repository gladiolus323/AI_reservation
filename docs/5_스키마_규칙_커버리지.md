# 스키마 규칙 커버리지 보고서

**작성일**: 2025-12-29

---

## 1. 개요

| 항목 | 수치 |
|------|------|
| 매뉴얼 총 규칙 | 170개 |
| 정형화 가능 규칙 | 139개 (81.8%) |
| 스키마 표현 가능 | 139개 (100%) |

---

## 2. 스키마 구조

### 2.1 테이블 구성

| 테이블명 | 용도 | 레코드 수 |
|----------|------|----------|
| EXAM_MASTER | 검사 속성 정의 | 267개 |
| EXAM_RELATION_RULES | 검사 간 관계 규칙 | 97개 |
| EXAM_CONDITION_RULES | 조건부 규칙 | 120개 (54 RULE_ID) |

### 2.2 EXAM_MASTER 스키마

| 컬럼명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| EXAM_CD | VARCHAR(20) | Y | 검사 코드 |
| EXAM_NM | VARCHAR(100) | Y | 검사명 |
| DURATION_MIN | INT | Y | 소요시간(분) |
| PREP_MIN | INT | N | 준비시간(분) |
| WALK_IN_POLICY | CHAR(1) | N | 예약없이 방문 정책 |
| RESULT_DAYS | DECIMAL(3,1) | N | 결과 소요일 |
| FASTING_HRS | INT | N | 금식시간 |
| CONTRAST_YN | CHAR(1) | N | 조영제 사용 여부 |
| SEDATION_YN | CHAR(1) | N | 진정 여부 |
| MIN_AGE | INT | N | 최소 연령 |
| MAX_AGE | INT | N | 최대 연령 |
| AVAIL_START_TIME | TIME | N | 예약 가능 시작 |
| AVAIL_END_TIME | TIME | N | 예약 가능 종료 |
| EQUIPMENT_TYPE | VARCHAR(10) | Y | 장비 유형 |

### 2.3 EXAM_RELATION_RULES 스키마

| 컬럼명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| EXAM_A | VARCHAR(20) | Y | 선행 검사 코드 |
| EXAM_B | VARCHAR(20) | Y | 후행 검사 코드 |
| SEQ_REQ_YN | CHAR(1) | N | 순서 필수 (Y/N) |
| SAME_DAY_CD | CHAR(1) | Y | 당일 가능 (Y/N/C) |
| GAP_VALUE | INT | N | A→B 간격 수치 |
| GAP_UNIT | CHAR(1) | N | 간격 단위 (D/H/M) |
| REV_GAP_VALUE | INT | N | B→A 역방향 간격 |
| REV_GAP_UNIT | CHAR(1) | N | 역방향 단위 |
| REASON_CD | VARCHAR(20) | N | 제한 사유 코드 |

### 2.4 EXAM_CONDITION_RULES 스키마

| 컬럼명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| RULE_ID | VARCHAR(20) | Y | 규칙 ID (그룹 키) |
| EXAM_CD | VARCHAR(20) | Y | 대상 검사 코드 |
| COND_TYPE | VARCHAR(20) | Y | 조건 종류 |
| COND_OP | VARCHAR(10) | Y | 비교 연산자 |
| COND_VAL | VARCHAR(100) | Y | 조건 기준값 |
| ACTION_CD | VARCHAR(20) | Y | 필수 조치 코드 |
| ACTION_VAL | VARCHAR(200) | N | 조치 상세 값 |

---

## 3. 코드 정의

### 3.1 SAME_DAY_CD (당일 시행 코드)

| 코드 | 의미 |
|------|------|
| Y | 당일 시행 가능 |
| N | 당일 시행 불가 |
| C | 조건부 가능 |

### 3.2 GAP_UNIT (간격 단위)

| 코드 | 의미 |
|------|------|
| D | Day (일) |
| H | Hour (시간) |
| M | Minute (분) |

### 3.3 REASON_CD (제한 사유)

| 코드 | 의미 | 예시 |
|------|------|------|
| CONTRAST | 조영제 간섭 | CT조영 → 핵의학 2일 |
| FASTING | 금식 관련 | 금식검사 순서 |
| BOWEL | 장정결 관련 | 대장내시경 → PET 3일 |
| SEDATION | 진정 관련 | 진정검사 당일 1회 |
| RADIATION | 방사선 관련 | 핵의학 간 간격 |
| CARDIAC | 심장검사 관련 | Heart MRI ↔ CPX |

### 3.4 COND_TYPE (조건 종류)

| 코드 | 의미 | 예시 |
|------|------|------|
| AGE | 연령 조건 | 만15세 이하 |
| MED | 약물 복용 | Metformin, Aspirin |
| ALLERGY | 알레르기 | 조영제 알레르기 |
| PREG | 임신/수유 | 임신 시 제한 |
| DISEASE | 질환 | 당뇨, 신부전 |
| DEVICE | 의료기기 | 심박동기 |
| WEEKDAY | 요일 | 토/일 |
| INTERVAL | 검사 간격 | 동일검사 180일 |
| TIMING | 도착 시간 | 1시간 전 도착 |
| SURGERY | 수술 유형 | LADG, LATG |
| LAB | 검사 수치 | eGFR, 혈당 |
| ACTIVITY | 활동 | 격렬운동 제한 |
| DIET | 식이 | 저잔사식, 요오드 |
| EXAM | 검사 유형 | 대장내시경, 경구조영 |
| SEDATION | 진정 | 진정검사 여부 |
| FASTING | 금식 | 6시간 금식 |

### 3.5 ACTION_CD (조치 코드)

| 코드 | 의미 | 예시 |
|------|------|------|
| GUARD | 보호자 동반 | 만19세 미만 |
| NOWEEKEND | 주말 불가 | 토/일 예약 제한 |
| TIMEONLY | 시간 제한 | 오전만 가능 |
| FASTING | 금식 필요 | 8시간 금식 |
| CONSENT | 동의 필요 | 알레르기 동의서 |
| PRETEST | 사전 검사 | eGFR 확인 |
| STOPMED | 약물 중단 | 48시간 전 중단 |
| ALLOWED | 허용 | MRI는 메포민 무관 |

---

## 4. 규칙 커버리지

### 4.1 규칙 분류별 현황

| 분류 | 개수 | 정형화 | 표현 스키마 |
|------|------|--------|------------|
| RELATION | 64개 | O | EXAM_RELATION_RULES |
| CONDITION | 54개 | O | EXAM_CONDITION_RULES |
| ATTRIBUTE | 21개 | O | EXAM_MASTER |
| LOGIC | 14개 | X | 코드 구현 필요 |
| UNNECESSARY | 17개 | X | 안내/운영 사항 |
| **합계** | **170개** | **139개** | - |

### 4.2 스키마별 규칙 매핑

| 스키마 | 커버 규칙 | 레코드 수 | 커버리지 |
|--------|----------|----------|----------|
| EXAM_MASTER | 21개 속성규칙 | 267개 검사 | 100% |
| EXAM_RELATION_RULES | 64개 관계규칙 | 97개 레코드 | 100% |
| EXAM_CONDITION_RULES | 54개 조건규칙 | 120개 레코드 | 100% |

### 4.3 RELATION 규칙 상세

| 규칙 유형 | 스키마 표현 | 레코드 수 |
|----------|------------|----------|
| 순서 필수 (A→B) | SEQ_REQ_YN = Y | 32개 |
| 당일 불가 | SAME_DAY_CD = N | 41개 |
| 당일 가능 | SAME_DAY_CD = Y | 8개 |
| 조건부 가능 | SAME_DAY_CD = C | 48개 |
| 간격 규칙 (일) | GAP_VALUE + GAP_UNIT=D | 52개 |
| 간격 규칙 (시간) | GAP_VALUE + GAP_UNIT=H | 4개 |
| 간격 규칙 (분) | GAP_VALUE + GAP_UNIT=M | 2개 |
| 역방향 간격 | REV_GAP_VALUE | 12개 |

### 4.4 CONDITION 규칙 상세

| COND_TYPE | 규칙 수 | 레코드 수 |
|-----------|--------|----------|
| AGE | 4개 | 14개 |
| MED | 8개 | 22개 |
| WEEKDAY | 3개 | 10개 |
| DISEASE | 4개 | 8개 |
| DEVICE | 2개 | 4개 |
| ALLERGY | 2개 | 4개 |
| PREG | 2개 | 4개 |
| INTERVAL | 3개 | 6개 |
| TIMING | 4개 | 8개 |
| SURGERY | 2개 | 4개 |
| LAB | 3개 | 6개 |
| ACTIVITY | 2개 | 4개 |
| DIET | 5개 | 10개 |
| EXAM | 3개 | 6개 |
| SEDATION | 2개 | 4개 |
| FASTING | 5개 | 12개 |
| **합계** | **54개** | **120개** |

### 4.5 ATTRIBUTE 규칙 상세

| 속성 | EXAM_MASTER 컬럼 | 규칙 수 |
|------|-----------------|--------|
| 소요시간 | DURATION_MIN | 5개 |
| 금식시간 | FASTING_HRS | 4개 |
| 조영제 | CONTRAST_YN | 3개 |
| 진정 | SEDATION_YN | 2개 |
| 연령제한 | MIN_AGE, MAX_AGE | 2개 |
| 운영시간 | AVAIL_START/END_TIME | 3개 |
| 결과일 | RESULT_DAYS | 2개 |
| **합계** | - | **21개** |

---

## 5. 정형화 불가 규칙

### 5.1 LOGIC (코드 구현 필요) - 14개

| 규칙 | 사유 |
|------|------|
| 동일 부위 동일 검사 중복 방지 | 검사코드+부위 조합 로직 |
| 의뢰과별 예약 슬롯 분배 | 쿼터 관리 로직 |
| 응급 우선순위 처리 | 우선순위 큐 |
| 자원 가용성 실시간 체크 | 리소스 매니저 |
| 복합검사 패키지 처리 | 패키지 로직 |
| 예약 변경 이력 관리 | 이력 테이블 |
| 취소/노쇼 정책 | 비즈니스 로직 |
| 슬롯 충돌 감지 | 스케줄링 알고리즘 |

### 5.2 UNNECESSARY (정형화 불필요) - 17개

| 규칙 | 사유 |
|------|------|
| 예약 확인 전화 안내 | 운영 정책 |
| 결과지 발급 안내 | 운영 정책 |
| 주차 안내 | 운영 정책 |
| 복장 안내 | 운영 정책 |
| 검사실 위치 안내 | 운영 정책 |
| 보험 청구 안내 | 과금 정책 |

---

## 6. 참조 무결성

| 검증 항목 | 결과 |
|----------|------|
| RELATION.EXAM_A → MASTER.EXAM_CD | PASS |
| RELATION.EXAM_B → MASTER.EXAM_CD | PASS |
| CONDITION.EXAM_CD → MASTER.EXAM_CD | PASS |

---

## 7. 결론

| 항목 | 결과 |
|------|------|
| 총 규칙 | 170개 |
| 스키마 표현 가능 | 139개 (81.8%) |
| 실제 데이터 반영 | 139개 (100%) |
| 참조 무결성 | PASS |

**3개 테이블로 139개 규칙 100% 커버 완료**
